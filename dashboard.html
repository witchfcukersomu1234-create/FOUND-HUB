<!DOCTYPE html>
<html lang="en" class="font-sans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Found-Hub Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body style="background-color:#1A1A1A;" class="min-h-screen text-gray-200">

<!-- HEADER -->
<header style="background-color:#121212;" class="p-4">
    <div class="container mx-auto flex justify-between items-center">
        <h1 class="text-2xl font-bold text-white">Found-Hub Dashboard</h1>
        <div class="space-x-6 hidden md:flex">
            <a href="index.html" class="hover:text-white text-gray-400">Home</a>
            <a href="lost-items.html" class="hover:text-white text-gray-400">Lost Items</a>
            <a href="found-items.html" class="hover:text-white text-gray-400">Found Items</a>
            <a href="dashboard.html" class="text-white font-bold">Dashboard</a>
            <button onclick="logout()" class="px-4 py-1 bg-red-600 rounded hover:bg-red-700">Logout</button>
        </div>
    </div>
</header>

<!-- MAIN CONTENT -->
<section class="container mx-auto py-10 px-4">
    <h2 class="text-3xl font-bold mb-6 text-yellow-300">Welcome Back!</h2>

    <!-- MY POSTS -->
    <div class="mb-12">
        <h3 class="text-2xl font-semibold mb-4 text-orange-400">My Posted Items</h3>
        
        <div id="myPosts" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- items will load here -->
        </div>
    </div>

    <!-- MY CLAIMS -->
    <div class="mb-12">
        <h3 class="text-2xl font-semibold mb-4 text-green-400">My Claims</h3>
        
        <div id="myClaims" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- claims will load here -->
        </div>
    </div>
</section>

<script>
const API = "https://found-hub-production-8fa3.up.railway.app";


function token() {
    return localStorage.getItem("fh_token");
}

function authHeader() {
    return { "Authorization": "Bearer " + token() };
}

if (!token()) {
    location.href = "login-signup.html";
}

async function loadDashboard() {
    // LOAD USER POSTS
    const postsRes = await fetch(`${API}/api/my/items`, { headers: authHeader() });
    const posts = await postsRes.json();

    document.getElementById("myPosts").innerHTML = posts.length
        ? posts.map(renderItem).join("")
        : `<p class="text-gray-400">No posts yet.</p>`;

    // LOAD USER CLAIMS
    const claimsRes = await fetch(`${API}/api/my/claims`, { headers: authHeader() });
    const claims = await claimsRes.json();

    document.getElementById("myClaims").innerHTML = claims.length
        ? claims.map(renderClaim).join("")
        : `<p class="text-gray-400">No claims submitted.</p>`;
}

function renderItem(i) {
    return `
        <div class="p-4 rounded-lg" style="background-color:#262626;">
            <h4 class="text-xl font-bold text-yellow-300">${i.title}</h4>
            <p class="text-sm text-gray-400">Type: ${i.type}</p>
            <p class="text-sm text-gray-400">Location: ${i.location || "N/A"}</p>
            <p class="text-sm text-gray-400">Description: ${i.description || ""}</p>
            <p class="text-sm text-gray-400 mt-2"><b>Status:</b> ${i.status}</p>

            ${i.photo_url 
                ? `<img src="${API}${i.photo_url}" class="mt-3 rounded-md max-h-48 object-cover w-full"/>`
                : ""
            }
        </div>
    `;
}

function renderClaim(c) {
    return `
        <div class="p-4 rounded-lg" style="background-color:#262626;">
            <h4 class="text-xl font-bold text-green-300">${c.title}</h4>
            <p class="text-sm text-gray-400">Item Type: ${c.type}</p>
            <p class="text-sm text-gray-400"><b>Your Message:</b> ${c.message}</p>
            <p class="text-sm text-gray-400 mt-2"><b>Status:</b> ${c.status}</p>
        </div>
    `;
}

function logout() {
    localStorage.removeItem("fh_token");
    localStorage.removeItem("fh_user");
    location.href = "index.html";
}

loadDashboard();
</script>

</body>
</html>
